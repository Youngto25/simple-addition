<title>首页</title>
<link rel="stylesheet" href="./style.css">

<h5>您的账户余额是<span id="acount">Blake_Yang</span></h5>
<button id="button">Pay</button>
<script>
    /*
    window.callback = function (result){
        if(result == 'success'){
            acount.innerText = acount.innerText - 1
        }else{

        }    
    }
    */
    button.addEventListener('click',()=>{
        let script = document.createElement('script')
        document.body.appendChild(script)
        let functionName = 'black'+parseInt(Math.random()*100000,10)
        window[functionName] = function (result){
            if(result == 'success'){
                acount.innerText = acount.innerText - 1
            }else{

            }   
        }
        console.log(window[functionName]);
        script.src = 'http://localhost:8001/pay?callback='+functionName
        //消除新建script的影响
        script.onload = function (e){
            e.currentTarget.remove()
            delete window[functionName]
        }
        /*
        script.onload = function (){
            alert('成功')
            //局部变化
            acount.innerText = acount.innerText - 1
            //window.location.reload()刷新页面
        }
        */
        script.onerror = function (e){
            alert('失败')
            e.currentTarget.remove()
            delete window[functionName]
        }
    })
    
    
    
    
    /*
    button.addEventListener('click',()=>{
        let image = document.createElement('img')
        image.src = '/pay'
        image.onload = function (){
            alert('成功')
            //局部变化
            acount.innerText = acount.innerText - 1
            //window.location.reload()刷新页面
        }
        image.onerror = function (){
            alert('失败')
        }
    })
    */
</script>
